<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nigeria Navigation Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css">

<style>
html, body { margin:0; height:100%; }
#map { height:100%; width:100%; }

.location-label {
  background: rgba(0,0,0,0.7);
  color: white;
  font-size: 13px;
  font-weight: bold;
  border: none;
  padding: 2px 6px;
}
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

<script>
/* ðŸ”Š VOICE */
function speak(text){
  speechSynthesis.cancel();
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";
  speechSynthesis.speak(msg);
}

/* ðŸ‡³ðŸ‡¬ NIGERIA ONLY */
const nigeriaBounds = [
  [4.0, 2.5],
  [14.5, 14.8]
];

/* ðŸ—º MAP */
const map = L.map('map',{
  maxBounds: nigeriaBounds,
  maxBoundsViscosity: 1.0,
  minZoom: 6,
  maxZoom: 18
}).setView([9.0820, 8.6753], 7.5);

/* ðŸ—º NORMAL MAP */
const normalMap = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { maxZoom:18 }
).addTo(map);

/* ðŸ›° SATELLITE */
const satellite = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { maxZoom:18 }
);

/* ðŸ›£ ROADS OVERLAY */
const roads = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { opacity:0.35 }
);

/* ðŸ”€ LAYER SWITCH */
L.control.layers(
  { "Normal Map": normalMap, "Satellite": satellite },
  { "Roads": roads }
).addTo(map);

/* ðŸ“ USER LOCATION */
let userMarker = null;
let userLatLng = null;
let firstZoom = true;

navigator.geolocation.watchPosition(
  pos=>{
    userLatLng = [pos.coords.latitude, pos.coords.longitude];
    if(!userMarker){
      userMarker = L.marker(userLatLng).addTo(map)
        .bindPopup("ðŸ“ You are here").openPopup();
      if(firstZoom){
        map.setView(userLatLng,15);
        speak("Your location has been detected");
        firstZoom = false;
      }
    } else {
      userMarker.setLatLng(userLatLng);
    }
  },
  ()=>alert("Enable GPS"),
  { enableHighAccuracy:true }
);

/* ðŸ”´ ICON */
const redIcon = new L.Icon({
  iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
  iconSize:[42,42],
  iconAnchor:[21,42]
});

/* âš ï¸ DANGER LOCATIONS (ADD MORE UP TO 50) */
const dangerZones = [
  {name:"Maiduguri, Borno", lat:11.8469, lng:13.1571},
  {name:"Gwoza, Borno", lat:11.0845, lng:13.6959},
  {name:"Birnin Gwari, Kaduna", lat:10.6639, lng:6.5406},
  {name:"Anka, Zamfara", lat:11.9107, lng:5.9266}
];

/* ðŸ§­ ROUTING */
let routeControl = null;

function startNavigation(dest){
  if(!userLatLng){ alert("Waiting for GPS"); return; }
  if(routeControl) map.removeControl(routeControl);

  speak("Navigation started to " + dest.name);

  routeControl = L.Routing.control({
    waypoints:[
      L.latLng(userLatLng[0], userLatLng[1]),
      L.latLng(dest.lat, dest.lng)
    ],
    addWaypoints:false,
    draggableWaypoints:false,
    show:false,
    createMarker:()=>null,
    router: L.Routing.osrmv1({profile:'car', language:'en'})
  })
  .on('routesfound', e=>{
    const steps = e.routes[0].instructions;
    steps.forEach((s,i)=>{
      setTimeout(()=>{
        speak(s.text + ", " + Math.round(s.distance) + " meters");
      }, i*4500);
    });
  })
  .addTo(map);
}

/* ðŸš© ADD MARKERS */
dangerZones.forEach(z=>{
  L.marker([z.lat,z.lng],{icon:redIcon})
    .addTo(map)
    .bindTooltip(z.name,{
      permanent:true,
      direction:"top",
      className:"location-label"
    })
    .bindPopup("<b>"+z.name+"</b><br>High-risk area (news-reported)")
    .on("click",()=>startNavigation(z));
});
</script>
</body>
</html>
